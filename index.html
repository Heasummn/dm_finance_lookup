<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css"
              integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
                integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
                crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"
                integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
                crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="test.css"/>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Dance Marathon Finance Lookup</title>
    </head>

    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
            <div class="container">
                <a class="navbar-brand" href="#">Dance Marathon 2019-2020</a>
            </div>
        </nav>
        <div class="container">

            <div class="row">
                <div class="col-lg-12 text-center">
                    <h1 class="mt-5">See how much you've raised!</h1>
                    <p class="lead">Enter your student ID below.</p>
                </div>
            </div>

            <form role='form' id="searchform">
                <div class="input-group mb3">
                    <input type="text" class="form-control" pattern="\d{5}" maxlength="5" name="id" id='studentID' placeholder="Enter your student ID number here"
                        class='form-control'>
                    <div class="input-group-append">
                        <button class="btn btn-outline-primary" id="submitbtn" type="submit">Search</button>
                    </div>
                </div>
            </form>

            <div class="row">
                <div class="col-lg-12 text-center">
                    <div id="temperature" style="display:none;">
                        <div id="goal">$250</div>
                        <div id="glass">
                            <div id="progress">
                            </div>
                        </div>
                        <div class="goal-stat">
                            <span class="goal-number" id="raised">$0</span>
                            <span class="goal-label">Raised</span>
                        </div>
                        <div class="goal-stat">
                                <span class="goal-number" id="pct">0%</span>
                                <span class="goal-label">Percent Of Goal</span>
                            </div>
                        <div class="goal-stat">
                            <span class="goal-number" id="count">
                                <div id="countdown"></div>
                            </span>
                            <span class="goal-label">Days to Go</span>
                        </div>
                        <!-- <div class="goal-stat">
                            <span class="goal-number" id="sponsors">38</span>
                            <span class="goal-label">ROle</span>
                        </div> -->
                    </div>
                </div>
            </div>
            </br>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <p>Please contact
                        <a href="mailto:nnfinance@dm219.org">Dance Marathon Finance</a> for any questions.</p>
                </div>
            </div>


            <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Error</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p style='text-align:left;'>
                                Cannot find user in the Dance Marathon database with the given ID number. Please note the database may not be updated until
                                Wednesday evening.
                                </br>Please contact
                                <a href="mailto:nnfinance@dm219.org">Dance Marathon Finance</a> for any questions.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

        </body>
        
    <script type="text/javascript">
        window.onload = function () {
            var text_input = document.getElementById('studentID');
            text_input.focus();
            text_input.select();
        }
        $('#searchform').submit(function () {
            $("#submitbtn").text("");
            $("#temperature").css("display","none");
            // Append a spinner
            $("#submitbtn").append("<i class=\"fa fa-circle-o-notch fa-spin\" style=\"font-size:16px\"></i>")
            search();
            // Don't refresh the page upon submit, so return false
            return false;
        });
        function processData(data) {
            var items = {};
                // Replace the button with submit text
                $("#submitbtn").empty().text("Submit");
                $.each(data, function (key, val) {
                    // Remove dollar signs to compute percentages
                    items[key] = parseFloat(val.replace(/\$|,/g, '')).toFixed(2);
                });
                if (items["goal"] != null) {
                    $("#goal").text("Goal: " + "$" + items["goal"]);
                    //$("nav").css("display");
                    // Fade in for 2s
                    $("#temperature").fadeIn(2000);
                    // Set the width to be proportional to the percent to goal
                    $("#progress").css("width", items["total"] / items["goal"] * 100 + "%");
                    // Set the percentage marker
                    $("#pct").text(Math.round(items["total"] / items["goal"] * 100 * 100) / 100 + "%");
                    // Set the amount raised
                    $("#raised").text("$" + items["total"]);
                } else {
                    // Toggle the error modal the API returns an empty JSON object
                    $('#myModal').modal('toggle');
                }
        }
        // Makes the async JSON request from the API
        function search() {
            var v = $("#studentID").val();
            $.getJSON("lookup.php?id=" + v, processData);
        }
        // The below is functionality to get the Countdown timer working
        CountDownTimer('05/16/2020 5:1 PM', 'countdown');
        function CountDownTimer(dt, id) {
            var end = new Date(dt);
            var _second = 1000;
            var _minute = _second * 60;
            var _hour = _minute * 60;
            var _day = _hour * 24;
            var timer;
            function showRemaining() {
                var now = new Date();
                var distance = end - now;
                if (distance < 0) {
                    clearInterval(timer);
                    document.getElementById(id).innerHTML = '0';
                    return;
                }
                var days = Math.floor(distance / _day);
                var hours = Math.floor((distance % _day) / _hour);
                var minutes = Math.floor((distance % _hour) / _minute);
                var seconds = Math.floor((distance % _minute) / _second);
                if (document.getElementById(id) != null) {
                    // result has loaded;
                    document.getElementById(id).innerHTML = days /*+ ' days'*/ ;
                }
                //document.getElementById(id).innerHTML += hours + 'hrs ';
                //document.getElementById(id).innerHTML += minutes + 'mins ';
                //document.getElementById(id).innerHTML += seconds + 'secs';
            }
            showRemaining();
        }
    </script>

</html>
